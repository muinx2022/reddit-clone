{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/reddit-clone/frontend/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["import NextAuth, { type NextAuthOptions } from \"next-auth\"\r\nimport GoogleProvider from \"next-auth/providers/google\"\r\nimport CredentialsProvider from \"next-auth/providers/credentials\"\r\nimport type { JWT } from \"next-auth/jwt\"\r\n\r\n// ===== TYPES =====\r\ninterface StrapiUser {\r\n    id: number\r\n    username: string\r\n    email: string\r\n    provider?: string\r\n}\r\n\r\ninterface CredentialsUser {\r\n    id: string\r\n    name: string\r\n    email: string\r\n    strapiJwt: string\r\n    profile: StrapiUser\r\n}\r\n\r\n// ===== ENV =====\r\nconst GOOGLE_CLIENT_ID = process.env.GOOGLE_CLIENT_ID\r\nconst GOOGLE_CLIENT_SECRET = process.env.GOOGLE_CLIENT_SECRET\r\nconst STRAPI_API_URL = process.env.NEXT_PUBLIC_API_URL\r\n\r\nif (!GOOGLE_CLIENT_ID || !GOOGLE_CLIENT_SECRET) {\r\n    throw new Error(\"Missing Google OAuth env vars\")\r\n}\r\n\r\nif (!STRAPI_API_URL) {\r\n    throw new Error(\"Missing NEXT_PUBLIC_API_URL\")\r\n}\r\n\r\n// ===== AUTH OPTIONS =====\r\nexport const authOptions: NextAuthOptions = {\r\n    providers: [\r\n        // ===== GOOGLE OAUTH =====\r\n        GoogleProvider({\r\n            clientId: GOOGLE_CLIENT_ID,\r\n            clientSecret: GOOGLE_CLIENT_SECRET,\r\n        }),\r\n\r\n        // ===== LOCAL LOGIN =====\r\n        CredentialsProvider({\r\n            name: \"Credentials\",\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"text\" },\r\n                password: { label: \"Password\", type: \"password\" },\r\n            },\r\n\r\n            async authorize(credentials) {\r\n                if (!credentials?.email || !credentials.password) {\r\n                    return null\r\n                }\r\n\r\n                try {\r\n                    const res = await fetch(`${STRAPI_API_URL}/auth/local`, {\r\n                        method: \"POST\",\r\n                        headers: { \"Content-Type\": \"application/json\" },\r\n                        body: JSON.stringify({\r\n                            identifier: credentials.email,\r\n                            password: credentials.password,\r\n                        }),\r\n                    })\r\n\r\n                    if (!res.ok) return null\r\n\r\n                    const data: { jwt: string; user: StrapiUser } = await res.json()\r\n\r\n                    const user: CredentialsUser = {\r\n                        id: String(data.user.id),\r\n                        name: data.user.username,\r\n                        email: data.user.email,\r\n                        strapiJwt: data.jwt,\r\n                        profile: data.user,\r\n                    }\r\n\r\n                    return user\r\n                } catch (err) {\r\n                    console.error(\"Local login error\", err)\r\n                    return null\r\n                }\r\n            },\r\n        }),\r\n    ],\r\n\r\n    session: {\r\n        strategy: \"jwt\",\r\n    },\r\n\r\n    callbacks: {\r\n        async jwt({ token, user, account }) {\r\n            // ===== LOCAL LOGIN =====\r\n            if (user && \"strapiJwt\" in user) {\r\n                const u = user as CredentialsUser\r\n                token.strapiJwt = u.strapiJwt\r\n                token.strapiUser = u.profile\r\n            }\r\n\r\n            // ===== GOOGLE OAUTH =====\r\n            if (account?.provider === \"google\" && account.access_token) {\r\n                try {\r\n                    const res = await fetch(\r\n                        `${STRAPI_API_URL}/auth/google/callback?access_token=${account.access_token}`\r\n                    )\r\n\r\n                    if (res.ok) {\r\n                        const data: { jwt: string; user: StrapiUser } = await res.json()\r\n                        token.strapiJwt = data.jwt\r\n                        token.strapiUser = data.user\r\n                    } else {\r\n                        console.error(\r\n                            \"Strapi OAuth failed\",\r\n                            res.status,\r\n                            await res.text()\r\n                        )\r\n                    }\r\n                } catch (err) {\r\n                    console.error(\"JWT OAuth error\", err)\r\n                }\r\n            }\r\n\r\n            return token\r\n        },\r\n\r\n        async session({ session, token }) {\r\n            session.strapiJwt = token.strapiJwt as string | undefined\r\n            session.strapiUser = token.strapiUser as StrapiUser | undefined\r\n            return session\r\n        },\r\n    },\r\n}\r\n\r\n// ===== HANDLER =====\r\nconst handler = NextAuth(authOptions)\r\nexport { handler as GET, handler as POST }\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;;;;AAmBA,kBAAkB;AAClB,MAAM,mBAAmB,QAAQ,GAAG,CAAC,gBAAgB;AACrD,MAAM,uBAAuB,QAAQ,GAAG,CAAC,oBAAoB;AAC7D,MAAM;AAEN,IAAI,CAAC,oBAAoB,CAAC,sBAAsB;IAC5C,MAAM,IAAI,MAAM;AACpB;AAEA;;AAKO,MAAM,cAA+B;IACxC,WAAW;QACP,2BAA2B;QAC3B,IAAA,gKAAc,EAAC;YACX,UAAU;YACV,cAAc;QAClB;QAEA,0BAA0B;QAC1B,IAAA,qKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YAEA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,SAAS,CAAC,YAAY,QAAQ,EAAE;oBAC9C,OAAO;gBACX;gBAEA,IAAI;oBACA,MAAM,MAAM,MAAM,MAAM,GAAG,eAAe,WAAW,CAAC,EAAE;wBACpD,QAAQ;wBACR,SAAS;4BAAE,gBAAgB;wBAAmB;wBAC9C,MAAM,KAAK,SAAS,CAAC;4BACjB,YAAY,YAAY,KAAK;4BAC7B,UAAU,YAAY,QAAQ;wBAClC;oBACJ;oBAEA,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;oBAEpB,MAAM,OAA0C,MAAM,IAAI,IAAI;oBAE9D,MAAM,OAAwB;wBAC1B,IAAI,OAAO,KAAK,IAAI,CAAC,EAAE;wBACvB,MAAM,KAAK,IAAI,CAAC,QAAQ;wBACxB,OAAO,KAAK,IAAI,CAAC,KAAK;wBACtB,WAAW,KAAK,GAAG;wBACnB,SAAS,KAAK,IAAI;oBACtB;oBAEA,OAAO;gBACX,EAAE,OAAO,KAAK;oBACV,QAAQ,KAAK,CAAC,qBAAqB;oBACnC,OAAO;gBACX;YACJ;QACJ;KACH;IAED,SAAS;QACL,UAAU;IACd;IAEA,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE,OAAO,EAAE;YAC9B,0BAA0B;YAC1B,IAAI,QAAQ,eAAe,MAAM;gBAC7B,MAAM,IAAI;gBACV,MAAM,SAAS,GAAG,EAAE,SAAS;gBAC7B,MAAM,UAAU,GAAG,EAAE,OAAO;YAChC;YAEA,2BAA2B;YAC3B,IAAI,SAAS,aAAa,YAAY,QAAQ,YAAY,EAAE;gBACxD,IAAI;oBACA,MAAM,MAAM,MAAM,MACd,GAAG,eAAe,mCAAmC,EAAE,QAAQ,YAAY,EAAE;oBAGjF,IAAI,IAAI,EAAE,EAAE;wBACR,MAAM,OAA0C,MAAM,IAAI,IAAI;wBAC9D,MAAM,SAAS,GAAG,KAAK,GAAG;wBAC1B,MAAM,UAAU,GAAG,KAAK,IAAI;oBAChC,OAAO;wBACH,QAAQ,KAAK,CACT,uBACA,IAAI,MAAM,EACV,MAAM,IAAI,IAAI;oBAEtB;gBACJ,EAAE,OAAO,KAAK;oBACV,QAAQ,KAAK,CAAC,mBAAmB;gBACrC;YACJ;YAEA,OAAO;QACX;QAEA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,QAAQ,SAAS,GAAG,MAAM,SAAS;YACnC,QAAQ,UAAU,GAAG,MAAM,UAAU;YACrC,OAAO;QACX;IACJ;AACJ;AAEA,sBAAsB;AACtB,MAAM,UAAU,IAAA,kJAAQ,EAAC"}}]
}
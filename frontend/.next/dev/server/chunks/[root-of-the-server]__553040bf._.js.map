{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/reddit-clone/frontend/app/api/auth/%5B...nextauth%5D/route.ts"],"sourcesContent":["// frontend/app/api/auth/[...nextauth]/route.ts\r\nimport NextAuth, { NextAuthOptions } from \"next-auth\";\r\nimport CredentialsProvider from \"next-auth/providers/credentials\";\r\nimport GoogleProvider from \"next-auth/providers/google\";\r\nimport axios from \"axios\";\r\n\r\nconst STRAPI_URL = process.env.STRAPI_URL || \"http://localhost:1337\";\r\n\r\n// ----- Type profile -----\r\ninterface UserProfile {\r\n    displayName?: string;\r\n    avatar?: string;\r\n    bio?: string;\r\n}\r\n\r\ninterface AppUser {\r\n    id: number;\r\n    email: string;\r\n    username?: string;\r\n    accessToken?: string;\r\n    profile?: UserProfile;\r\n}\r\n\r\n// ----- NextAuth options -----\r\nexport const authOptions: NextAuthOptions = {\r\n    providers: [\r\n        // ===== Local login =====\r\n        CredentialsProvider({\r\n            name: \"Credentials\",\r\n            credentials: {\r\n                email: { label: \"Email\", type: \"text\" },\r\n                password: { label: \"Password\", type: \"password\" },\r\n            },\r\n            async authorize(credentials) {\r\n                if (!credentials) return null;\r\n\r\n                try {\r\n                    const res = await axios.post(`${STRAPI_URL}/api/auth/local`, {\r\n                        identifier: credentials.email,\r\n                        password: credentials.password,\r\n                    });\r\n\r\n                    const strapiUser = res.data.user;\r\n\r\n                    const user: AppUser = {\r\n                        id: Number(strapiUser.id),\r\n                        email: strapiUser.email,\r\n                        username: strapiUser.username,\r\n                        accessToken: res.data.jwt,\r\n                        profile: strapiUser.profile || {},\r\n                    };\r\n\r\n                    // Sync profile ngay sau login\r\n                    try {\r\n                        await axios.post(`${STRAPI_URL}/api/profiles/sync`, {\r\n                            userId: user.id,\r\n                            email: user.email,\r\n                            displayName: user.profile?.displayName || user.username,\r\n                            avatar: user.profile?.avatar || null,\r\n                        });\r\n                    } catch (err) {\r\n                        console.error(\"Profile sync error:\", err);\r\n                    }\r\n\r\n                    return user;\r\n                } catch (err) {\r\n                    console.error(err);\r\n                    return null;\r\n                }\r\n            },\r\n        }),\r\n\r\n        // ===== Google OAuth =====\r\n        GoogleProvider({\r\n            clientId: process.env.GOOGLE_CLIENT_ID!,\r\n            clientSecret: process.env.GOOGLE_CLIENT_SECRET!,\r\n            profile(profile) {\r\n                return {\r\n                    id: Number(profile.sub),\r\n                    email: profile.email,\r\n                    username: profile.name,\r\n                    profile: {\r\n                        displayName: profile.name,\r\n                        avatar: profile.picture,\r\n                    },\r\n                };\r\n            },\r\n        }),\r\n    ],\r\n\r\n    session: { strategy: \"jwt\" },\r\n\r\n    callbacks: {\r\n        async jwt({ token, user }) {\r\n            if (user) {\r\n                token.id = Number(user.id);\r\n                token.accessToken = user.accessToken;\r\n                token.username = user.username;\r\n                token.profile = user.profile;\r\n            }\r\n            return token;\r\n        },\r\n\r\n        async session({ session, token }) {\r\n            if (token) {\r\n                session.user.id = Number(token.id);\r\n                session.user.accessToken = token.accessToken;\r\n                session.user.username = token.username;\r\n                session.user.profile = token.profile;\r\n            }\r\n            return session;\r\n        },\r\n    },\r\n\r\n    pages: {\r\n        signIn: \"/auth/signin\",\r\n    },\r\n};\r\n\r\nexport default NextAuth(authOptions);\r\n"],"names":[],"mappings":"AAAA,+CAA+C;;;;;;;AAC/C;AACA;AACA;AACA;;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAkBtC,MAAM,cAA+B;IACxC,WAAW;QACP,0BAA0B;QAC1B,IAAA,qKAAmB,EAAC;YAChB,MAAM;YACN,aAAa;gBACT,OAAO;oBAAE,OAAO;oBAAS,MAAM;gBAAO;gBACtC,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YACpD;YACA,MAAM,WAAU,WAAW;gBACvB,IAAI,CAAC,aAAa,OAAO;gBAEzB,IAAI;oBACA,MAAM,MAAM,MAAM,kJAAK,CAAC,IAAI,CAAC,GAAG,WAAW,eAAe,CAAC,EAAE;wBACzD,YAAY,YAAY,KAAK;wBAC7B,UAAU,YAAY,QAAQ;oBAClC;oBAEA,MAAM,aAAa,IAAI,IAAI,CAAC,IAAI;oBAEhC,MAAM,OAAgB;wBAClB,IAAI,OAAO,WAAW,EAAE;wBACxB,OAAO,WAAW,KAAK;wBACvB,UAAU,WAAW,QAAQ;wBAC7B,aAAa,IAAI,IAAI,CAAC,GAAG;wBACzB,SAAS,WAAW,OAAO,IAAI,CAAC;oBACpC;oBAEA,8BAA8B;oBAC9B,IAAI;wBACA,MAAM,kJAAK,CAAC,IAAI,CAAC,GAAG,WAAW,kBAAkB,CAAC,EAAE;4BAChD,QAAQ,KAAK,EAAE;4BACf,OAAO,KAAK,KAAK;4BACjB,aAAa,KAAK,OAAO,EAAE,eAAe,KAAK,QAAQ;4BACvD,QAAQ,KAAK,OAAO,EAAE,UAAU;wBACpC;oBACJ,EAAE,OAAO,KAAK;wBACV,QAAQ,KAAK,CAAC,uBAAuB;oBACzC;oBAEA,OAAO;gBACX,EAAE,OAAO,KAAK;oBACV,QAAQ,KAAK,CAAC;oBACd,OAAO;gBACX;YACJ;QACJ;QAEA,2BAA2B;QAC3B,IAAA,gKAAc,EAAC;YACX,UAAU,QAAQ,GAAG,CAAC,gBAAgB;YACtC,cAAc,QAAQ,GAAG,CAAC,oBAAoB;YAC9C,SAAQ,OAAO;gBACX,OAAO;oBACH,IAAI,OAAO,QAAQ,GAAG;oBACtB,OAAO,QAAQ,KAAK;oBACpB,UAAU,QAAQ,IAAI;oBACtB,SAAS;wBACL,aAAa,QAAQ,IAAI;wBACzB,QAAQ,QAAQ,OAAO;oBAC3B;gBACJ;YACJ;QACJ;KACH;IAED,SAAS;QAAE,UAAU;IAAM;IAE3B,WAAW;QACP,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACrB,IAAI,MAAM;gBACN,MAAM,EAAE,GAAG,OAAO,KAAK,EAAE;gBACzB,MAAM,WAAW,GAAG,KAAK,WAAW;gBACpC,MAAM,QAAQ,GAAG,KAAK,QAAQ;gBAC9B,MAAM,OAAO,GAAG,KAAK,OAAO;YAChC;YACA,OAAO;QACX;QAEA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC5B,IAAI,OAAO;gBACP,QAAQ,IAAI,CAAC,EAAE,GAAG,OAAO,MAAM,EAAE;gBACjC,QAAQ,IAAI,CAAC,WAAW,GAAG,MAAM,WAAW;gBAC5C,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAM,QAAQ;gBACtC,QAAQ,IAAI,CAAC,OAAO,GAAG,MAAM,OAAO;YACxC;YACA,OAAO;QACX;IACJ;IAEA,OAAO;QACH,QAAQ;IACZ;AACJ;uCAEe,IAAA,kJAAQ,EAAC"}}]
}